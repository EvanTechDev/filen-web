import{r as e,u as be,j as t,c as Ae,d as Ie,e as ae,I as V,f as _e,g as Be,s as Z,w as We,A as Le,h as oe,B as ee}from"./index-WHS-zVl3.js";import{L as J}from"./link-CjGj8ghz.js";import{u as we}from"./useNavigate-BF6CjfOd.js";const He=e.memo(({children:l})=>{const{t:n}=be();return t.jsx("div",{className:"h-screen w-screen",children:t.jsxs("div",{className:"flex h-full w-full flex-col overflow-auto",children:[t.jsxs(J,{to:"/login",className:"flex shrink-0 flex-row justify-center py-10 sm:justify-start sm:pl-20 items-center gap-2",children:[t.jsx("img",{src:"https://drive.filen.io/static/media/light_logo.9f8ed143e54adb31009008c527f52c95.svg",className:"w-7 h-7",draggable:!1}),t.jsx("p",{className:"font-medium text-2xl",children:"Filen"})]}),t.jsx("div",{className:"flex h-full flex-col items-center justify-center",children:t.jsx("div",{className:"flex flex-col p-8 w-80 sm:w-[420px]",children:l})}),t.jsxs("div",{className:"flex shrink-0 flex-row justify-center items-center py-10 gap-5",children:[t.jsx(J,{to:"/login",className:"underline text-muted-foreground text-sm select-none",children:n("auth.footer.tos")}),t.jsx(J,{to:"/login",className:"underline text-muted-foreground text-sm select-none",children:n("auth.footer.privacy")})]})]})})}),$e=e.memo(({children:l})=>{const[n]=Ae("authed",!1),a=we(),d=Ie();return e.useEffect(()=>{n&&a({to:"/drive/$",replace:!0,resetScroll:!0,params:{_splat:d.baseFolderUUID}})},[a,n,d]),n?null:l});var Ke=Object.defineProperty,ze=Object.defineProperties,Ge=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable,Se=(l,n,a)=>n in l?Ke(l,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[n]=a,Ue=(l,n)=>{for(var a in n||(n={}))je.call(n,a)&&Se(l,a,n[a]);if(te)for(var a of te(n))ye.call(n,a)&&Se(l,a,n[a]);return l},qe=(l,n)=>ze(l,Ge(n)),Ve=(l,n)=>{var a={};for(var d in l)je.call(l,d)&&n.indexOf(d)<0&&(a[d]=l[d]);if(l!=null&&te)for(var d of te(l))n.indexOf(d)<0&&ye.call(l,d)&&(a[d]=l[d]);return a},Je="^\\d+$";function Qe(l){let n=setTimeout(l,0),a=setTimeout(l,10),d=setTimeout(l,50);return[n,a,d]}var Xe=18,Ye="40px",Ze=["[data-lastpass-icon-root]","com-1password-button","[data-dashlanecreated]",'[style$="2147483647 !important;"]'].join(",");function et({inputRef:l,pwmAreaRef:n,pushPasswordManagerStrategy:a,isFocused:d}){let x=e.useRef({done:!1,refocused:!1}),[u,F]=e.useState(!1),[w,M]=e.useState(!1),[b,B]=e.useState(!1),W=e.useMemo(()=>a==="none"?!1:a==="increase-width"&&u&&w||a==="experimental-no-flickering"&&(!b||b&&w&&u),[b,u,w,a]),E=e.useCallback(()=>{let s=l.current,i=n.current;if(!s||!i||b||a==="none")return;let p=a==="increase-width"?s:i,N=p.getBoundingClientRect().left+p.offsetWidth,v=p.getBoundingClientRect().top+p.offsetHeight/2,c=N-Xe,D=v,O=document.elementFromPoint(c,D);if((document.querySelectorAll(Ze).length>0||O!==s)&&(F(!0),B(!0),!x.current.refocused&&document.activeElement===s)){let f=[s.selectionStart,s.selectionEnd];s.blur(),s.focus(),s.setSelectionRange(f[0],f[1]),x.current.refocused=!0}},[b,l,a,n]);return e.useEffect(()=>{let s=new IntersectionObserver(i=>{let p=i[0];M(p.intersectionRatio>.99)},{threshold:1,root:null,rootMargin:"0px"});return n.current&&s.observe(n.current),()=>{s.disconnect()}},[n]),e.useEffect(()=>{let s=d||document.activeElement===l.current;if(a==="none"||!s)return;let i=setTimeout(E,0),p=setTimeout(E,2e3),N=setTimeout(E,5e3),v=setTimeout(()=>{B(!0)},6e3);return()=>{clearTimeout(i),clearTimeout(p),clearTimeout(N),clearTimeout(v)}},[l,d,a,E]),{willPushPWMBadge:W,PWM_BADGE_SPACE_WIDTH:Ye}}function tt(l){let n=e.useRef();return e.useEffect(()=>{n.current=l}),n.current}var Ee=e.forwardRef((l,n)=>{var a=l,{value:d,onChange:x,maxLength:u,textAlign:F="left",pattern:w=Je,inputMode:M="numeric",onComplete:b,pushPasswordManagerStrategy:B="increase-width",render:W,containerClassName:E,noScriptCSSFallback:s=nt}=a,i=Ve(a,["value","onChange","maxLength","textAlign","pattern","inputMode","onComplete","pushPasswordManagerStrategy","render","containerClassName","noScriptCSSFallback"]),p,N,v,c;let[D,O]=e.useState(typeof i.defaultValue=="string"?i.defaultValue:""),f=d??D,X=tt(f),K=e.useCallback(r=>{x==null||x(r),O(r)},[x]),j=e.useMemo(()=>w?typeof w=="string"?new RegExp(w):w:null,[w]),g=e.useRef(null),ce=e.useRef(null),ue=e.useRef(null),ne=e.useRef({value:f,onChange:K,isIOS:typeof window<"u"&&((p=window==null?void 0:window.CSS)==null?void 0:p.supports("-webkit-touch-callout","none"))}),Y=e.useRef({prev:[(N=g.current)==null?void 0:N.selectionStart,(v=g.current)==null?void 0:v.selectionEnd,(c=g.current)==null?void 0:c.selectionDirection]});e.useImperativeHandle(n,()=>g.current,[]),e.useEffect(()=>{let r=g.current,o=ce.current;if(!r||!o)return;ne.current.value!==r.value&&ne.current.onChange(r.value),Y.current.prev=[r.selectionStart,r.selectionEnd,r.selectionDirection];function h(){if(document.activeElement!==r){G(null),U(null);return}let m=r.selectionStart,S=r.selectionEnd,k=r.selectionDirection,A=r.maxLength,I=r.value,H=Y.current.prev,P=-1,R=-1,$;if(I.length!==0&&m!==null&&S!==null){let De=m===S,Oe=m===I.length&&I.length<A;if(De&&!Oe){let _=m;if(_===0)P=0,R=1,$="forward";else if(_===A)P=_-1,R=_,$="backward";else if(A>2&&I.length>2){let re=0;if(H[0]!==null&&H[1]!==null){$=_<H[1]?"backward":"forward";let Te=H[0]===H[1]&&H[0]<A;$==="backward"&&!Te&&(re=-1)}P=re+_,R=re+_+1}}P!==-1&&R!==-1&&P!==R&&g.current.setSelectionRange(P,R,$)}let xe=P!==-1?P:m,ve=R!==-1?R:S,Me=$??k;G(xe),U(ve),Y.current.prev=[xe,ve,Me]}if(document.addEventListener("selectionchange",h,{capture:!0}),h(),document.activeElement===r&&le(!0),!document.getElementById("input-otp-style")){let m=document.createElement("style");if(m.id="input-otp-style",document.head.appendChild(m),m.sheet){let S="background: transparent !important; text: transparent !important; border-color: transparent !important; opacity: 0 !important; box-shadow: none !important; -webkit-box-shadow: none !important; -webkit-text-fill-color: transparent !important;";Q(m.sheet,"[data-input-otp]::selection { background: transparent !important; }"),Q(m.sheet,`[data-input-otp]:autofill { ${S} }`),Q(m.sheet,`[data-input-otp]:-webkit-autofill { ${S} }`),Q(m.sheet,"@supports (-webkit-touch-callout: none) { [data-input-otp] { letter-spacing: -.6em !important; font-weight: 100 !important; font-stretch: ultra-condensed; font-optical-sizing: none !important; left: -1px !important; right: 1px !important; } }"),Q(m.sheet,"[data-input-otp] + * { pointer-events: all !important; }")}}let y=()=>{o&&o.style.setProperty("--root-height",`${r.clientHeight}px`)};y();let C=new ResizeObserver(y);return C.observe(r),()=>{document.removeEventListener("selectionchange",h,{capture:!0}),C.disconnect()}},[]);let[de,me]=e.useState(!1),[z,le]=e.useState(!1),[T,G]=e.useState(null),[L,U]=e.useState(null);e.useEffect(()=>{Qe(()=>{var r,o,h,y;(r=g.current)==null||r.dispatchEvent(new Event("input"));let C=(o=g.current)==null?void 0:o.selectionStart,m=(h=g.current)==null?void 0:h.selectionEnd,S=(y=g.current)==null?void 0:y.selectionDirection;C!==null&&m!==null&&(G(C),U(m),Y.current.prev=[C,m,S])})},[f,z]),e.useEffect(()=>{X!==void 0&&f!==X&&X.length<u&&f.length===u&&(b==null||b(f))},[u,b,X,f]);let q=et({inputRef:g,pwmAreaRef:ue,pushPasswordManagerStrategy:B,isFocused:z}),pe=e.useCallback(r=>{let o=r.currentTarget.value.slice(0,u);if(o.length>0&&j&&!j.test(o)){r.preventDefault();return}K(o)},[u,K,j]),fe=e.useCallback(()=>{var r;if(g.current){let o=Math.min(g.current.value.length,u-1),h=g.current.value.length;(r=g.current)==null||r.setSelectionRange(o,h),G(o),U(h)}le(!0)},[u]),ge=e.useCallback(r=>{var o,h;let y=g.current;if(!ne.current.isIOS||!r.clipboardData||!y)return;let C=r.clipboardData.getData("text/plain");r.preventDefault();let m=(o=g.current)==null?void 0:o.selectionStart,S=(h=g.current)==null?void 0:h.selectionEnd,k=(m!==S?f.slice(0,m)+C+f.slice(S):f.slice(0,m)+C+f.slice(m)).slice(0,u);if(k.length>0&&j&&!j.test(k))return;y.value=k,K(k);let A=Math.min(k.length,u-1),I=k.length;y.setSelectionRange(A,I),G(A),U(I)},[u,K,j,f]),Pe=e.useMemo(()=>({position:"relative",cursor:i.disabled?"default":"text",userSelect:"none",WebkitUserSelect:"none",pointerEvents:"none"}),[i.disabled]),he=e.useMemo(()=>({position:"absolute",inset:0,width:q.willPushPWMBadge?`calc(100% + ${q.PWM_BADGE_SPACE_WIDTH})`:"100%",height:"100%",display:"flex",textAlign:F,opacity:"1",color:"transparent",pointerEvents:"all",background:"transparent",caretColor:"transparent",border:"0 solid transparent",outline:"0 solid transparent",boxShadow:"none",lineHeight:"1",letterSpacing:"-.5em",fontSize:"var(--root-height)",fontFamily:"monospace",fontVariantNumeric:"tabular-nums"}),[q.PWM_BADGE_SPACE_WIDTH,q.willPushPWMBadge,F]),Re=e.useMemo(()=>e.createElement("input",qe(Ue({autoComplete:i.autoComplete||"one-time-code"},i),{"data-input-otp":!0,"data-input-otp-mss":T,"data-input-otp-mse":L,inputMode:M,pattern:j==null?void 0:j.source,style:he,maxLength:u,value:f,ref:g,onPaste:r=>{var o;ge(r),(o=i.onPaste)==null||o.call(i,r)},onChange:pe,onMouseOver:r=>{var o;me(!0),(o=i.onMouseOver)==null||o.call(i,r)},onMouseLeave:r=>{var o;me(!1),(o=i.onMouseLeave)==null||o.call(i,r)},onFocus:r=>{var o;fe(),(o=i.onFocus)==null||o.call(i,r)},onBlur:r=>{var o;le(!1),(o=i.onBlur)==null||o.call(i,r)}})),[pe,fe,ge,M,he,u,L,T,i,j==null?void 0:j.source,f]),Fe=e.useMemo(()=>W({slots:Array.from({length:u}).map((r,o)=>{let h=z&&T!==null&&L!==null&&(T===L&&o===T||o>=T&&o<L),y=f[o]!==void 0?f[o]:null;return{char:y,isActive:h,hasFakeCaret:h&&y===null}}),isFocused:z,isHovering:!i.disabled&&de}),[z,de,u,L,T,i.disabled,W,f]);return e.createElement(e.Fragment,null,s!==null&&e.createElement("noscript",null,e.createElement("style",null,s)),e.createElement("div",{ref:ce,"data-input-otp-container":!0,style:Pe,className:E},e.createElement("div",{ref:ue,style:{position:"absolute",top:0,right:`calc(-1 * ${q.PWM_BADGE_SPACE_WIDTH})`,bottom:0,left:"100%",pointerEvents:"none",userSelect:"none",background:"transparent"}}),Fe,e.createElement("div",{style:{position:"absolute",inset:0,pointerEvents:"none"}},Re)))});Ee.displayName="Input";function Q(l,n){try{l.insertRule(n)}catch{console.error("input-otp could not insert CSS rule:",n)}}var nt=`
[data-input-otp] {
  --nojs-bg: white !important;
  --nojs-fg: black !important;

  background-color: var(--nojs-bg) !important;
  color: var(--nojs-fg) !important;
  caret-color: var(--nojs-fg) !important;
  letter-spacing: .25em !important;
  text-align: center !important;
  border: 1px solid var(--nojs-fg) !important;
  border-radius: 4px !important;
  width: 100% !important;
}
@media (prefers-color-scheme: dark) {
  [data-input-otp] {
    --nojs-bg: black !important;
    --nojs-fg: white !important;
  }
}`;const Ne=e.forwardRef(({className:l,...n},a)=>t.jsx(Ee,{ref:a,containerClassName:ae("flex items-center gap-2",l),...n}));Ne.displayName="InputOTP";const se=e.forwardRef(({className:l,...n},a)=>t.jsx("div",{ref:a,className:ae("flex items-center",l),...n}));se.displayName="InputOTPGroup";const ie=e.forwardRef(({char:l,hasFakeCaret:n,isActive:a,className:d,...x},u)=>t.jsxs("div",{ref:u,className:ae("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",a&&"z-10 ring-2 ring-offset-background ring-ring",d),...x,children:[l,n&&t.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:t.jsx("div",{className:"animate-caret-blink h-4 w-px bg-foreground duration-1000"})})]}));ie.displayName="InputOTPSlot";const Ce=e.forwardRef(({...l},n)=>t.jsx("div",{ref:n,role:"separator",...l,children:t.jsx(V,{name:"dot"})}));Ce.displayName="InputOTPSeparator";const lt=_e("/login")({component:ke});function ke(){const[l,n]=e.useState(""),[a,d]=e.useState(""),[x,u]=e.useState(""),[F,w]=e.useState(!1),[M,b]=e.useState(!1),[B,W]=e.useState(!1),{toast:E}=Be(),{t:s}=be(),i=we(),[p,N]=e.useState(!1),v=e.useCallback(async()=>{N(!0);try{await Z.login({email:l,password:a,twoFactorCode:x}),await We.initializeSDK({config:Z.config}),localStorage.setItem("sdkConfig",JSON.stringify(Z.config)),localStorage.setItem("authed","true"),i({to:"/drive/$",replace:!0,resetScroll:!0,params:{_splat:Z.config.baseFolderUUID}})}catch(c){if(c instanceof Le&&c.code==="enter_2fa"){u(""),w(!0);return}d(""),u(""),w(!1),b(!1),E({variant:"destructive",description:c.message})}finally{N(!1)}},[l,a,x,E,i]);return t.jsx($e,{children:t.jsx(He,{children:t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("h1",{className:"text-2xl font-semibold",children:s("login.header")}),t.jsx("p",{className:"text-muted-foreground text-sm",children:s(F?M?"login.alerts.enter2FARecoveryKey":"login.alerts.enter2FA":"login.description")})]}),t.jsx("div",{className:"flex flex-col gap-3",children:F?t.jsx(t.Fragment,{children:M?t.jsxs(t.Fragment,{children:[t.jsx(oe,{id:"twoFactorCode",required:!0,autoFocus:!0,type:"text",placeholder:s("login.placeholders.normal.2faRecoveryKey"),value:x,onChange:c=>u(c.target.value),onKeyDown:c=>{c.key==="Enter"&&v()}}),t.jsx(ee,{className:"w-full mt-4",type:"submit",onClick:v,disabled:p,children:p?t.jsx(V,{name:"loader",className:"animate-spin-medium"}):s("login.buttons.login")})]}):t.jsxs(t.Fragment,{children:[t.jsx(Ne,{maxLength:6,autoFocus:!0,onKeyDown:c=>{c.key==="Enter"&&v()},value:x,onChange:u,render:({slots:c})=>t.jsxs(t.Fragment,{children:[t.jsxs(se,{children:[c.slice(0,3).map((D,O)=>t.jsx(ie,{...D},O))," "]}),t.jsx(Ce,{}),t.jsx(se,{children:c.slice(3).map((D,O)=>t.jsx(ie,{...D},O))})]})}),t.jsx("p",{className:"text-muted-foreground text-sm underline mt-4 cursor-pointer",onClick:()=>b(!0),children:s("login.useTwoFactorRecoveryKey")}),t.jsx(ee,{className:"w-full mt-4",type:"submit",onClick:v,disabled:p,children:p?t.jsx(V,{name:"loader",className:"animate-spin-medium"}):s("login.buttons.login")})]})}):t.jsxs(t.Fragment,{children:[t.jsx(oe,{id:"email",placeholder:s("login.placeholders.example.email"),required:!0,type:"email",value:l,onChange:c=>n(c.target.value),onKeyDown:c=>{c.key==="Enter"&&v()}}),t.jsxs("div",{className:"w-full flex flex-row",children:[t.jsx(oe,{id:"password",required:!0,type:B?"text":"password",placeholder:s("login.placeholders.normal.password"),value:a,onChange:c=>d(c.target.value),onKeyDown:c=>{c.key==="Enter"&&v()}}),t.jsx("div",{className:"flex flex-row absolute w-80 sm:w-[420px] h-10 ml-80 sm:ml-[420px]",children:t.jsx("div",{className:"flex flex-row items-center h-full w-full ml-[-95px]",children:t.jsx(V,{name:"eye",size:20,className:"cursor-pointer",onClick:()=>W(c=>!c)})})})]}),t.jsx(ee,{className:"w-full select-none mt-2",type:"submit",onClick:v,disabled:p,children:p?t.jsx(V,{name:"loader",className:"animate-spin-medium"}):s("login.buttons.login")}),t.jsx(J,{className:"inline-block w-full text-center text-sm underline text-muted-foreground",to:"/login",disabled:p,children:t.jsx(ee,{className:"w-full select-none",variant:"outline",disabled:p,children:s("login.buttons.createAccount")})}),t.jsx(J,{className:"inline-block w-full text-center text-sm underline text-muted-foreground select-none",to:"/login",disabled:p,children:s("login.buttons.forgotPassword")})]})})]})})})}export{ke as Login,lt as Route};
