import{aq as m,ar as U,as as re,at as ie,au as ve,av as xt,aw as wt,ax as d,ay as St,az as Ct,aA as be,aB as ye,aC as Ue,aD as ke,aE as M,aF as J,aG as Je,aH as Ge,aI as At,aJ as Ke,aK as Mt,aL as q,aM as je,aN as v,aO as Dt,aP as Lt,aQ as Bt,aR as G,aS as S,aT as Tt,aU as xe,aV as K,aW as Rt,aX as Ot,aY as Et,aZ as Wt,a_ as ko,a$ as xo,b0 as wo,b1 as It,b2 as qt,b3 as Qe,b4 as So,b5 as Ze,b6 as Pt,b7 as Co,b8 as Ye,b9 as Ao,ba as Mo,bb as Do,bc as Ft,bd as Nt,be as Ht,bf as we,bg as zt,bh as Lo,bi as u,bj as Vt,r as D,bk as Bo,j as To,_ as Ro}from"./index-WHS-zVl3.js";import{bK as Oo,bl as Eo,bm as Wo,bn as Io,bL as qo,bo as Po,bM as Fo,bN as No,bp as Ho,bO as zo,bP as Vo,bQ as $o,bq as Uo,bR as Jo,bS as Go,br as Ko,bs as jo,bt as Qo,bT as Zo,bu as Yo,bv as Xo,bw as _o,bx as er,by as tr,bz as nr,bA as or,bB as rr,bC as ir,bD as sr,bE as ar,bF as lr,bG as cr,bH as hr,bI as ur,bJ as fr}from"./index-WHS-zVl3.js";const dr=e=>{let{state:t}=e,o=t.doc.lineAt(t.selection.main.from),n=_e(e.state,o.from);return n.line?mr(e):n.block?gr(e):!1};function Xe(e,t){return({state:o,dispatch:n})=>{if(o.readOnly)return!1;let r=e(t,o);return r?(n(o.update(r)),!0):!1}}const mr=Xe(yr,0),pr=Xe($t,0),gr=Xe((e,t)=>$t(e,t,br(t)),0);function _e(e,t){let o=e.languageDataAt("commentTokens",t);return o.length?o[0]:{}}const se=50;function vr(e,{open:t,close:o},n,r){let i=e.sliceDoc(n-se,n),s=e.sliceDoc(r,r+se),a=/\s*$/.exec(i)[0].length,l=/^\s*/.exec(s)[0].length,h=i.length-a;if(i.slice(h-t.length,h)==t&&s.slice(l,l+o.length)==o)return{open:{pos:n-a,margin:a&&1},close:{pos:r+l,margin:l&&1}};let c,f;r-n<=2*se?c=f=e.sliceDoc(n,r):(c=e.sliceDoc(n,n+se),f=e.sliceDoc(r-se,r));let g=/^\s*/.exec(c)[0].length,b=/\s*$/.exec(f)[0].length,w=f.length-b-o.length;return c.slice(g,g+t.length)==t&&f.slice(w,w+o.length)==o?{open:{pos:n+g+t.length,margin:/\s/.test(c.charAt(g+t.length))?1:0},close:{pos:r-b-o.length,margin:/\s/.test(f.charAt(w-1))?1:0}}:null}function br(e){let t=[];for(let o of e.selection.ranges){let n=e.doc.lineAt(o.from),r=o.to<=n.to?n:e.doc.lineAt(o.to),i=t.length-1;i>=0&&t[i].to>n.from?t[i].to=r.to:t.push({from:n.from+/^\s*/.exec(n.text)[0].length,to:r.to})}return t}function $t(e,t,o=t.selection.ranges){let n=o.map(i=>_e(t,i.from).block);if(!n.every(i=>i))return null;let r=o.map((i,s)=>vr(t,n[s],i.from,i.to));if(e!=2&&!r.every(i=>i))return{changes:t.changes(o.map((i,s)=>r[s]?[]:[{from:i.from,insert:n[s].open+" "},{from:i.to,insert:" "+n[s].close}]))};if(e!=1&&r.some(i=>i)){let i=[];for(let s=0,a;s<r.length;s++)if(a=r[s]){let l=n[s],{open:h,close:c}=a;i.push({from:h.pos-l.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+l.close.length})}return{changes:i}}return null}function yr(e,t,o=t.selection.ranges){let n=[],r=-1;for(let{from:i,to:s}of o){let a=n.length,l=1e9,h=_e(t,i).line;if(h){for(let c=i;c<=s;){let f=t.doc.lineAt(c);if(f.from>r&&(i==s||s>f.from)){r=f.from;let g=/^\s*/.exec(f.text)[0].length,b=g==f.length,w=f.text.slice(g,g+h.length)==h?g:-1;g<f.text.length&&g<l&&(l=g),n.push({line:f,comment:w,token:h,indent:g,empty:b,single:!1})}c=f.to+1}if(l<1e9)for(let c=a;c<n.length;c++)n[c].indent<n[c].line.text.length&&(n[c].indent=l);n.length==a+1&&(n[a].single=!0)}}if(e!=2&&n.some(i=>i.comment<0&&(!i.empty||i.single))){let i=[];for(let{line:a,token:l,indent:h,empty:c,single:f}of n)(f||!c)&&i.push({from:a.from+h,insert:l+" "});let s=t.changes(i);return{changes:s,selection:t.selection.map(s,1)}}else if(e!=1&&n.some(i=>i.comment>=0)){let i=[];for(let{line:s,comment:a,token:l}of n)if(a>=0){let h=s.from+a,c=h+l.length;s.text[c-s.from]==" "&&c++,i.push({from:h,to:c})}return{changes:i}}return null}const et=ke.define(),kr=ke.define(),xr=U.define(),Ut=U.define({combine(e){return re(e,{minDepth:100,newGroupDelay:500,joinToEvent:(t,o)=>o},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(t,o)=>(n,r)=>t(n,r)||o(n,r)})}}),Jt=ie.define({create(){return E.empty},update(e,t){let o=t.state.facet(Ut),n=t.annotation(et);if(n){let l=x.fromTransaction(t,n.selection),h=n.side,c=h==0?e.undone:e.done;return l?c=Ce(c,c.length,o.minDepth,l):c=Qt(c,t.startState.selection),new E(h==0?n.rest:c,h==0?c:n.rest)}let r=t.annotation(kr);if((r=="full"||r=="before")&&(e=e.isolate()),t.annotation(ve.addToHistory)===!1)return t.changes.empty?e:e.addMapping(t.changes.desc);let i=x.fromTransaction(t),s=t.annotation(ve.time),a=t.annotation(ve.userEvent);return i?e=e.addChanges(i,s,a,o,t):t.selection&&(e=e.addSelection(t.startState.selection,s,a,o.newGroupDelay)),(r=="full"||r=="after")&&(e=e.isolate()),e},toJSON(e){return{done:e.done.map(t=>t.toJSON()),undone:e.undone.map(t=>t.toJSON())}},fromJSON(e){return new E(e.done.map(x.fromJSON),e.undone.map(x.fromJSON))}});function Gt(e={}){return[Jt,Ut.of(e),m.domEventHandlers({beforeinput(t,o){let n=t.inputType=="historyUndo"?Kt:t.inputType=="historyRedo"?tt:null;return n?(t.preventDefault(),n(o)):!1}})]}function Se(e,t){return function({state:o,dispatch:n}){if(!t&&o.readOnly)return!1;let r=o.field(Jt,!1);if(!r)return!1;let i=r.pop(e,o,t);return i?(n(i),!0):!1}}const Kt=Se(0,!1),tt=Se(1,!1),wr=Se(0,!0),Sr=Se(1,!0);class x{constructor(t,o,n,r,i){this.changes=t,this.effects=o,this.mapped=n,this.startSelection=r,this.selectionsAfter=i}setSelAfter(t){return new x(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,o,n;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(o=this.mapped)===null||o===void 0?void 0:o.toJSON(),startSelection:(n=this.startSelection)===null||n===void 0?void 0:n.toJSON(),selectionsAfter:this.selectionsAfter.map(r=>r.toJSON())}}static fromJSON(t){return new x(t.changes&&xt.fromJSON(t.changes),[],t.mapped&&wt.fromJSON(t.mapped),t.startSelection&&d.fromJSON(t.startSelection),t.selectionsAfter.map(d.fromJSON))}static fromTransaction(t,o){let n=L;for(let r of t.startState.facet(xr)){let i=r(t);i.length&&(n=n.concat(i))}return!n.length&&t.changes.empty?null:new x(t.changes.invert(t.startState.doc),n,void 0,o||t.startState.selection,L)}static selection(t){return new x(void 0,L,void 0,void 0,t)}}function Ce(e,t,o,n){let r=t+1>o+20?t-o-1:0,i=e.slice(r,t);return i.push(n),i}function Cr(e,t){let o=[],n=!1;return e.iterChangedRanges((r,i)=>o.push(r,i)),t.iterChangedRanges((r,i,s,a)=>{for(let l=0;l<o.length;){let h=o[l++],c=o[l++];a>=h&&s<=c&&(n=!0)}}),n}function Ar(e,t){return e.ranges.length==t.ranges.length&&e.ranges.filter((o,n)=>o.empty!=t.ranges[n].empty).length===0}function jt(e,t){return e.length?t.length?e.concat(t):e:t}const L=[],Mr=200;function Qt(e,t){if(e.length){let o=e[e.length-1],n=o.selectionsAfter.slice(Math.max(0,o.selectionsAfter.length-Mr));return n.length&&n[n.length-1].eq(t)?e:(n.push(t),Ce(e,e.length-1,1e9,o.setSelAfter(n)))}else return[x.selection([t])]}function Dr(e){let t=e[e.length-1],o=e.slice();return o[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),o}function nt(e,t){if(!e.length)return e;let o=e.length,n=L;for(;o;){let r=Lr(e[o-1],t,n);if(r.changes&&!r.changes.empty||r.effects.length){let i=e.slice(0,o);return i[o-1]=r,i}else t=r.mapped,o--,n=r.selectionsAfter}return n.length?[x.selection(n)]:L}function Lr(e,t,o){let n=jt(e.selectionsAfter.length?e.selectionsAfter.map(a=>a.map(t)):L,o);if(!e.changes)return x.selection(n);let r=e.changes.map(t),i=t.mapDesc(e.changes,!0),s=e.mapped?e.mapped.composeDesc(i):i;return new x(r,M.mapEffects(e.effects,t),s,e.startSelection.map(i),n)}const Br=/^(input\.type|delete)($|\.)/;class E{constructor(t,o,n=0,r=void 0){this.done=t,this.undone=o,this.prevTime=n,this.prevUserEvent=r}isolate(){return this.prevTime?new E(this.done,this.undone):this}addChanges(t,o,n,r,i){let s=this.done,a=s[s.length-1];return a&&a.changes&&!a.changes.empty&&t.changes&&(!n||Br.test(n))&&(!a.selectionsAfter.length&&o-this.prevTime<r.newGroupDelay&&r.joinToEvent(i,Cr(a.changes,t.changes))||n=="input.type.compose")?s=Ce(s,s.length-1,r.minDepth,new x(t.changes.compose(a.changes),jt(t.effects,a.effects),a.mapped,a.startSelection,L)):s=Ce(s,s.length,r.minDepth,t),new E(s,L,o,n)}addSelection(t,o,n,r){let i=this.done.length?this.done[this.done.length-1].selectionsAfter:L;return i.length>0&&o-this.prevTime<r&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&Ar(i[i.length-1],t)?this:new E(Qt(this.done,t),this.undone,o,n)}addMapping(t){return new E(nt(this.done,t),nt(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,o,n){let r=t==0?this.done:this.undone;if(r.length==0)return null;let i=r[r.length-1],s=i.selectionsAfter[0]||o.selection;if(n&&i.selectionsAfter.length)return o.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:et.of({side:t,rest:Dr(r),selection:s}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(i.changes){let a=r.length==1?L:r.slice(0,r.length-1);return i.mapped&&(a=nt(a,i.mapped)),o.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:et.of({side:t,rest:a,selection:s}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}}E.empty=new E(L,L);const Zt=[{key:"Mod-z",run:Kt,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:tt,preventDefault:!0},{linux:"Ctrl-Shift-z",run:tt,preventDefault:!0},{key:"Mod-u",run:wr,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Sr,preventDefault:!0}];function j(e,t){return d.create(e.ranges.map(t),e.mainIndex)}function O(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function R({state:e,dispatch:t},o){let n=j(e.selection,o);return n.eq(e.selection,!0)?!1:(t(O(e,n)),!0)}function Ae(e,t){return d.cursor(t?e.to:e.from)}function Yt(e,t){return R(e,o=>o.empty?e.moveByChar(o,t):Ae(o,t))}function k(e){return e.textDirectionAt(e.state.selection.main.head)==Mt.LTR}const Xt=e=>Yt(e,!k(e)),_t=e=>Yt(e,k(e));function en(e,t){return R(e,o=>o.empty?e.moveByGroup(o,t):Ae(o,t))}const Tr=e=>en(e,!k(e)),Rr=e=>en(e,k(e));function Or(e,t,o){if(t.type.prop(o))return!0;let n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function Me(e,t,o){let n=Je(e).resolveInner(t.head),r=o?Ge.closedBy:Ge.openedBy;for(let l=t.head;;){let h=o?n.childAfter(l):n.childBefore(l);if(!h)break;Or(e,h,r)?n=h:l=o?h.to:h.from}let i=n.type.prop(r),s,a;return i&&(s=o?J(e,n.from,1):J(e,n.to,-1))&&s.matched?a=o?s.end.to:s.end.from:a=o?n.to:n.from,d.cursor(a,o?-1:1)}const Er=e=>R(e,t=>Me(e.state,t,!k(e))),Wr=e=>R(e,t=>Me(e.state,t,k(e)));function tn(e,t){return R(e,o=>{if(!o.empty)return Ae(o,t);let n=e.moveVertically(o,t);return n.head!=o.head?n:e.moveToLineBoundary(o,t)})}const nn=e=>tn(e,!1),on=e=>tn(e,!0);function rn(e){let t=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,o=0,n=0,r;if(t){for(let i of e.state.facet(m.scrollMargins)){let s=i(e);s!=null&&s.top&&(o=Math.max(s==null?void 0:s.top,o)),s!=null&&s.bottom&&(n=Math.max(s==null?void 0:s.bottom,n))}r=e.scrollDOM.clientHeight-o-n}else r=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:o,marginBottom:n,selfScroll:t,height:Math.max(e.defaultLineHeight,r-5)}}function sn(e,t){let o=rn(e),{state:n}=e,r=j(n.selection,s=>s.empty?e.moveVertically(s,t,o.height):Ae(s,t));if(r.eq(n.selection))return!1;let i;if(o.selfScroll){let s=e.coordsAtPos(n.selection.main.head),a=e.scrollDOM.getBoundingClientRect(),l=a.top+o.marginTop,h=a.bottom-o.marginBottom;s&&s.top>l&&s.bottom<h&&(i=m.scrollIntoView(r.main.head,{y:"start",yMargin:s.top-l}))}return e.dispatch(O(n,r),{effects:i}),!0}const an=e=>sn(e,!1),ot=e=>sn(e,!0);function P(e,t,o){let n=e.lineBlockAt(t.head),r=e.moveToLineBoundary(t,o);if(r.head==t.head&&r.head!=(o?n.to:n.from)&&(r=e.moveToLineBoundary(t,o,!1)),!o&&r.head==n.from&&n.length){let i=/^\s*/.exec(e.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;i&&t.head!=n.from+i&&(r=d.cursor(n.from+i))}return r}const Ir=e=>R(e,t=>P(e,t,!0)),qr=e=>R(e,t=>P(e,t,!1)),Pr=e=>R(e,t=>P(e,t,!k(e))),Fr=e=>R(e,t=>P(e,t,k(e))),Nr=e=>R(e,t=>d.cursor(e.lineBlockAt(t.head).from,1)),Hr=e=>R(e,t=>d.cursor(e.lineBlockAt(t.head).to,-1));function zr(e,t,o){let n=!1,r=j(e.selection,i=>{let s=J(e,i.head,-1)||J(e,i.head,1)||i.head>0&&J(e,i.head-1,1)||i.head<e.doc.length&&J(e,i.head+1,-1);if(!s||!s.end)return i;n=!0;let a=s.start.from==i.head?s.end.to:s.end.from;return o?d.range(i.anchor,a):d.cursor(a)});return n?(t(O(e,r)),!0):!1}const Vr=({state:e,dispatch:t})=>zr(e,t,!1);function B(e,t){let o=j(e.state.selection,n=>{let r=t(n);return d.range(n.anchor,r.head,r.goalColumn,r.bidiLevel||void 0)});return o.eq(e.state.selection)?!1:(e.dispatch(O(e.state,o)),!0)}function ln(e,t){return B(e,o=>e.moveByChar(o,t))}const cn=e=>ln(e,!k(e)),hn=e=>ln(e,k(e));function un(e,t){return B(e,o=>e.moveByGroup(o,t))}const $r=e=>un(e,!k(e)),Ur=e=>un(e,k(e)),Jr=e=>B(e,t=>Me(e.state,t,!k(e))),Gr=e=>B(e,t=>Me(e.state,t,k(e)));function fn(e,t){return B(e,o=>e.moveVertically(o,t))}const dn=e=>fn(e,!1),mn=e=>fn(e,!0);function pn(e,t){return B(e,o=>e.moveVertically(o,t,rn(e).height))}const gn=e=>pn(e,!1),vn=e=>pn(e,!0),Kr=e=>B(e,t=>P(e,t,!0)),jr=e=>B(e,t=>P(e,t,!1)),Qr=e=>B(e,t=>P(e,t,!k(e))),Zr=e=>B(e,t=>P(e,t,k(e))),Yr=e=>B(e,t=>d.cursor(e.lineBlockAt(t.head).from)),Xr=e=>B(e,t=>d.cursor(e.lineBlockAt(t.head).to)),bn=({state:e,dispatch:t})=>(t(O(e,{anchor:0})),!0),yn=({state:e,dispatch:t})=>(t(O(e,{anchor:e.doc.length})),!0),kn=({state:e,dispatch:t})=>(t(O(e,{anchor:e.selection.main.anchor,head:0})),!0),xn=({state:e,dispatch:t})=>(t(O(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),_r=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),ei=({state:e,dispatch:t})=>{let o=Le(e).map(({from:n,to:r})=>d.range(n,Math.min(r+1,e.doc.length)));return t(e.update({selection:d.create(o),userEvent:"select"})),!0},ti=({state:e,dispatch:t})=>{let o=j(e.selection,n=>{var r;let i=Je(e).resolveStack(n.from,1);for(let s=i;s;s=s.next){let{node:a}=s;if((a.from<n.from&&a.to>=n.to||a.to>n.to&&a.from<=n.from)&&!((r=a.parent)===null||r===void 0)&&r.parent)return d.range(a.to,a.from)}return n});return t(O(e,o)),!0},ni=({state:e,dispatch:t})=>{let o=e.selection,n=null;return o.ranges.length>1?n=d.create([o.main]):o.main.empty||(n=d.create([d.cursor(o.main.head)])),n?(t(O(e,n)),!0):!1};function ae(e,t){if(e.state.readOnly)return!1;let o="delete.selection",{state:n}=e,r=n.changeByRange(i=>{let{from:s,to:a}=i;if(s==a){let l=t(i);l<s?(o="delete.backward",l=De(e,l,!1)):l>s&&(o="delete.forward",l=De(e,l,!0)),s=Math.min(s,l),a=Math.max(a,l)}else s=De(e,s,!1),a=De(e,a,!0);return s==a?{range:i}:{changes:{from:s,to:a},range:d.cursor(s,s<i.head?-1:1)}});return r.changes.empty?!1:(e.dispatch(n.update(r,{scrollIntoView:!0,userEvent:o,effects:o=="delete.selection"?m.announce.of(n.phrase("Selection deleted")):void 0})),!0)}function De(e,t,o){if(e instanceof m)for(let n of e.state.facet(m.atomicRanges).map(r=>r(e)))n.between(t,t,(r,i)=>{r<t&&i>t&&(t=o?i:r)});return t}const wn=(e,t)=>ae(e,o=>{let n=o.from,{state:r}=e,i=r.doc.lineAt(n),s,a;if(!t&&n>i.from&&n<i.from+200&&!/[^ \t]/.test(s=i.text.slice(0,n-i.from))){if(s[s.length-1]=="	")return n-1;let l=be(s,r.tabSize),h=l%Ke(r)||Ke(r);for(let c=0;c<h&&s[s.length-1-c]==" ";c++)n--;a=n}else a=q(i.text,n-i.from,t,t)+i.from,a==n&&i.number!=(t?r.doc.lines:1)?a+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(i.text.slice(a-i.from,n-i.from))&&(a=q(i.text,a-i.from,!1,!1)+i.from);return a}),rt=e=>wn(e,!1),Sn=e=>wn(e,!0),Cn=(e,t)=>ae(e,o=>{let n=o.head,{state:r}=e,i=r.doc.lineAt(n),s=r.charCategorizer(n);for(let a=null;;){if(n==(t?i.to:i.from)){n==o.head&&i.number!=(t?r.doc.lines:1)&&(n+=t?1:-1);break}let l=q(i.text,n-i.from,t)+i.from,h=i.text.slice(Math.min(n,l)-i.from,Math.max(n,l)-i.from),c=s(h);if(a!=null&&c!=a)break;(h!=" "||n!=o.head)&&(a=c),n=l}return n}),An=e=>Cn(e,!1),oi=e=>Cn(e,!0),ri=e=>ae(e,t=>{let o=e.lineBlockAt(t.head).to;return t.head<o?o:Math.min(e.state.doc.length,t.head+1)}),ii=e=>ae(e,t=>{let o=e.moveToLineBoundary(t,!1).head;return t.head>o?o:Math.max(0,t.head-1)}),si=e=>ae(e,t=>{let o=e.moveToLineBoundary(t,!0).head;return t.head<o?o:Math.min(e.state.doc.length,t.head+1)}),ai=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let o=e.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:Ue.of(["",""])},range:d.cursor(n.from)}));return t(e.update(o,{scrollIntoView:!0,userEvent:"input"})),!0},li=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let o=e.changeByRange(n=>{if(!n.empty||n.from==0||n.from==e.doc.length)return{range:n};let r=n.from,i=e.doc.lineAt(r),s=r==i.from?r-1:q(i.text,r-i.from,!1)+i.from,a=r==i.to?r+1:q(i.text,r-i.from,!0)+i.from;return{changes:{from:s,to:a,insert:e.doc.slice(r,a).append(e.doc.slice(s,r))},range:d.cursor(a)}});return o.changes.empty?!1:(t(e.update(o,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Le(e){let t=[],o=-1;for(let n of e.selection.ranges){let r=e.doc.lineAt(n.from),i=e.doc.lineAt(n.to);if(!n.empty&&n.to==i.from&&(i=e.doc.lineAt(n.to-1)),o>=r.number){let s=t[t.length-1];s.to=i.to,s.ranges.push(n)}else t.push({from:r.from,to:i.to,ranges:[n]});o=i.number+1}return t}function Mn(e,t,o){if(e.readOnly)return!1;let n=[],r=[];for(let i of Le(e)){if(o?i.to==e.doc.length:i.from==0)continue;let s=e.doc.lineAt(o?i.to+1:i.from-1),a=s.length+1;if(o){n.push({from:i.to,to:s.to},{from:i.from,insert:s.text+e.lineBreak});for(let l of i.ranges)r.push(d.range(Math.min(e.doc.length,l.anchor+a),Math.min(e.doc.length,l.head+a)))}else{n.push({from:s.from,to:i.from},{from:i.to,insert:e.lineBreak+s.text});for(let l of i.ranges)r.push(d.range(l.anchor-a,l.head-a))}}return n.length?(t(e.update({changes:n,scrollIntoView:!0,selection:d.create(r,e.selection.mainIndex),userEvent:"move.line"})),!0):!1}const ci=({state:e,dispatch:t})=>Mn(e,t,!1),hi=({state:e,dispatch:t})=>Mn(e,t,!0);function Dn(e,t,o){if(e.readOnly)return!1;let n=[];for(let r of Le(e))o?n.push({from:r.from,insert:e.doc.slice(r.from,r.to)+e.lineBreak}):n.push({from:r.to,insert:e.lineBreak+e.doc.slice(r.from,r.to)});return t(e.update({changes:n,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const ui=({state:e,dispatch:t})=>Dn(e,t,!1),fi=({state:e,dispatch:t})=>Dn(e,t,!0),di=e=>{if(e.state.readOnly)return!1;let{state:t}=e,o=t.changes(Le(t).map(({from:r,to:i})=>(r>0?r--:i<t.doc.length&&i++,{from:r,to:i}))),n=j(t.selection,r=>e.moveVertically(r,!0)).map(o);return e.dispatch({changes:o,selection:n,scrollIntoView:!0,userEvent:"delete.line"}),!0};function mi(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let o=Je(e).resolveInner(t),n=o.childBefore(t),r=o.childAfter(t),i;return n&&r&&n.to<=t&&r.from>=t&&(i=n.type.prop(Ge.closedBy))&&i.indexOf(r.name)>-1&&e.doc.lineAt(n.to).from==e.doc.lineAt(r.from).from&&!/\S/.test(e.sliceDoc(n.to,r.from))?{from:n.to,to:r.from}:null}const pi=Ln(!1),gi=Ln(!0);function Ln(e){return({state:t,dispatch:o})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>{let{from:i,to:s}=r,a=t.doc.lineAt(i),l=!e&&i==s&&mi(t,i);e&&(i=s=(s<=a.to?a:t.doc.lineAt(s)).to);let h=new St(t,{simulateBreak:i,simulateDoubleBreak:!!l}),c=Ct(h,i);for(c==null&&(c=be(/^\s*/.exec(t.doc.lineAt(i).text)[0],t.tabSize));s<a.to&&/\s/.test(a.text[s-a.from]);)s++;l?{from:i,to:s}=l:i>a.from&&i<a.from+100&&!/\S/.test(a.text.slice(0,i))&&(i=a.from);let f=["",ye(t,c)];return l&&f.push(ye(t,h.lineIndent(a.from,-1))),{changes:{from:i,to:s,insert:Ue.of(f)},range:d.cursor(i+1+f[1].length)}});return o(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0}}function it(e,t){let o=-1;return e.changeByRange(n=>{let r=[];for(let s=n.from;s<=n.to;){let a=e.doc.lineAt(s);a.number>o&&(n.empty||n.to>a.from)&&(t(a,r,n),o=a.number),s=a.to+1}let i=e.changes(r);return{changes:r,range:d.range(i.mapPos(n.anchor,1),i.mapPos(n.head,1))}})}const vi=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let o=Object.create(null),n=new St(e,{overrideIndentation:i=>o[i]??-1}),r=it(e,(i,s,a)=>{let l=Ct(n,i.from);if(l==null)return;/\S/.test(i.text)||(l=0);let h=/^\s*/.exec(i.text)[0],c=ye(e,l);(h!=c||a.from<i.from+h.length)&&(o[i.from]=l,s.push({from:i.from,to:i.from+h.length,insert:c}))});return r.changes.empty||t(e.update(r,{userEvent:"indent"})),!0},Bn=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(it(e,(o,n)=>{n.push({from:o.from,insert:e.facet(At)})}),{userEvent:"input.indent"})),!0),Tn=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(it(e,(o,n)=>{let r=/^\s*/.exec(o.text)[0];if(!r)return;let i=be(r,e.tabSize),s=0,a=ye(e,Math.max(0,i-Ke(e)));for(;s<r.length&&s<a.length&&r.charCodeAt(s)==a.charCodeAt(s);)s++;n.push({from:o.from+s,to:o.from+r.length,insert:a.slice(s)})}),{userEvent:"delete.dedent"})),!0),bi=[{key:"Ctrl-b",run:Xt,shift:cn,preventDefault:!0},{key:"Ctrl-f",run:_t,shift:hn},{key:"Ctrl-p",run:nn,shift:dn},{key:"Ctrl-n",run:on,shift:mn},{key:"Ctrl-a",run:Nr,shift:Yr},{key:"Ctrl-e",run:Hr,shift:Xr},{key:"Ctrl-d",run:Sn},{key:"Ctrl-h",run:rt},{key:"Ctrl-k",run:ri},{key:"Ctrl-Alt-h",run:An},{key:"Ctrl-o",run:ai},{key:"Ctrl-t",run:li},{key:"Ctrl-v",run:ot}],yi=[{key:"ArrowLeft",run:Xt,shift:cn,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:Tr,shift:$r,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:Pr,shift:Qr,preventDefault:!0},{key:"ArrowRight",run:_t,shift:hn,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Rr,shift:Ur,preventDefault:!0},{mac:"Cmd-ArrowRight",run:Fr,shift:Zr,preventDefault:!0},{key:"ArrowUp",run:nn,shift:dn,preventDefault:!0},{mac:"Cmd-ArrowUp",run:bn,shift:kn},{mac:"Ctrl-ArrowUp",run:an,shift:gn},{key:"ArrowDown",run:on,shift:mn,preventDefault:!0},{mac:"Cmd-ArrowDown",run:yn,shift:xn},{mac:"Ctrl-ArrowDown",run:ot,shift:vn},{key:"PageUp",run:an,shift:gn},{key:"PageDown",run:ot,shift:vn},{key:"Home",run:qr,shift:jr,preventDefault:!0},{key:"Mod-Home",run:bn,shift:kn},{key:"End",run:Ir,shift:Kr,preventDefault:!0},{key:"Mod-End",run:yn,shift:xn},{key:"Enter",run:pi},{key:"Mod-a",run:_r},{key:"Backspace",run:rt,shift:rt},{key:"Delete",run:Sn},{key:"Mod-Backspace",mac:"Alt-Backspace",run:An},{key:"Mod-Delete",mac:"Alt-Delete",run:oi},{mac:"Mod-Backspace",run:ii},{mac:"Mod-Delete",run:si}].concat(bi.map(e=>({mac:e.key,run:e.run,shift:e.shift}))),Rn=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Er,shift:Jr},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Wr,shift:Gr},{key:"Alt-ArrowUp",run:ci},{key:"Shift-Alt-ArrowUp",run:ui},{key:"Alt-ArrowDown",run:hi},{key:"Shift-Alt-ArrowDown",run:fi},{key:"Escape",run:ni},{key:"Mod-Enter",run:gi},{key:"Alt-l",mac:"Ctrl-l",run:ei},{key:"Mod-i",run:ti,preventDefault:!0},{key:"Mod-[",run:Tn},{key:"Mod-]",run:Bn},{key:"Mod-Alt-\\",run:vi},{key:"Shift-Mod-k",run:di},{key:"Shift-Mod-\\",run:Vr},{key:"Mod-/",run:dr},{key:"Alt-A",run:pr}].concat(yi),ki={key:"Tab",run:Bn,shift:Tn};function p(){var e=arguments[0];typeof e=="string"&&(e=document.createElement(e));var t=1,o=arguments[1];if(o&&typeof o=="object"&&o.nodeType==null&&!Array.isArray(o)){for(var n in o)if(Object.prototype.hasOwnProperty.call(o,n)){var r=o[n];typeof r=="string"?e.setAttribute(n,r):r!=null&&(e[n]=r)}t++}for(;t<arguments.length;t++)On(e,arguments[t]);return e}function On(e,t){if(typeof t=="string")e.appendChild(document.createTextNode(t));else if(t!=null)if(t.nodeType!=null)e.appendChild(t);else if(Array.isArray(t))for(var o=0;o<t.length;o++)On(e,t[o]);else throw new RangeError("Unsupported child node: "+t)}const En=typeof String.prototype.normalize=="function"?e=>e.normalize("NFKD"):e=>e;class Q{constructor(t,o,n=0,r=t.length,i,s){this.test=s,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=t.iterRange(n,r),this.bufferStart=n,this.normalize=i?a=>i(En(a)):En,this.query=this.normalize(o)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Dt(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let t=this.peek();if(t<0)return this.done=!0,this;let o=Lt(t),n=this.bufferStart+this.bufferPos;this.bufferPos+=Bt(t);let r=this.normalize(o);for(let i=0,s=n;;i++){let a=r.charCodeAt(i),l=this.match(a,s,this.bufferPos+this.bufferStart);if(i==r.length-1){if(l)return this.value=l,this;break}s==n&&i<o.length&&o.charCodeAt(i)==a&&s++}}}match(t,o,n){let r=null;for(let i=0;i<this.matches.length;i+=2){let s=this.matches[i],a=!1;this.query.charCodeAt(s)==t&&(s==this.query.length-1?r={from:this.matches[i+1],to:n}:(this.matches[i]++,a=!0)),a||(this.matches.splice(i,2),i-=2)}return this.query.charCodeAt(0)==t&&(this.query.length==1?r={from:o,to:n}:this.matches.push(1,o)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferStart)&&(r=null),r}}typeof Symbol<"u"&&(Q.prototype[Symbol.iterator]=function(){return this});const Wn={from:-1,to:-1,match:/.*/.exec("")},st="gm"+(/x/.unicode==null?"":"u");class In{constructor(t,o,n,r=0,i=t.length){if(this.text=t,this.to=i,this.curLine="",this.done=!1,this.value=Wn,/\\[sWDnr]|\n|\r|\[\^/.test(o))return new qn(t,o,n,r,i);this.re=new RegExp(o,st+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.iter=t.iter();let s=t.lineAt(r);this.curLineStart=s.from,this.matchPos=Be(t,r),this.getLine(this.curLineStart)}getLine(t){this.iter.next(t),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;let o=this.matchPos<=this.to&&this.re.exec(this.curLine);if(o){let n=this.curLineStart+o.index,r=n+o[0].length;if(this.matchPos=Be(this.text,r+(n==r?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<r||n>this.value.to)&&(!this.test||this.test(n,r,o)))return this.value={from:n,to:r,match:o},this;t=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),t=0;else return this.done=!0,this}}}const at=new WeakMap;class ee{constructor(t,o){this.from=t,this.text=o}get to(){return this.from+this.text.length}static get(t,o,n){let r=at.get(t);if(!r||r.from>=n||r.to<=o){let a=new ee(o,t.sliceString(o,n));return at.set(t,a),a}if(r.from==o&&r.to==n)return r;let{text:i,from:s}=r;return s>o&&(i=t.sliceString(o,s)+i,s=o),r.to<n&&(i+=t.sliceString(r.to,n)),at.set(t,new ee(s,i)),new ee(o,i.slice(o-s,n-s))}}class qn{constructor(t,o,n,r,i){this.text=t,this.to=i,this.done=!1,this.value=Wn,this.matchPos=Be(t,r),this.re=new RegExp(o,st+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.flat=ee.get(t,r,this.chunkEnd(r+5e3))}chunkEnd(t){return t>=this.to?this.to:this.text.lineAt(t).to}next(){for(;;){let t=this.re.lastIndex=this.matchPos-this.flat.from,o=this.re.exec(this.flat.text);if(o&&!o[0]&&o.index==t&&(this.re.lastIndex=t+1,o=this.re.exec(this.flat.text)),o){let n=this.flat.from+o.index,r=n+o[0].length;if((this.flat.to>=this.to||o.index+o[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,r,o)))return this.value={from:n,to:r,match:o},this.matchPos=Be(this.text,r+(n==r?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=ee.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(In.prototype[Symbol.iterator]=qn.prototype[Symbol.iterator]=function(){return this});function xi(e){try{return new RegExp(e,st),!0}catch{return!1}}function Be(e,t){if(t>=e.length)return t;let o=e.lineAt(t),n;for(;t<o.to&&(n=o.text.charCodeAt(t-o.from))>=56320&&n<57344;)t++;return t}function lt(e){let t=String(e.state.doc.lineAt(e.state.selection.main.head).number),o=p("input",{class:"cm-textfield",name:"line",value:t}),n=p("form",{class:"cm-gotoLine",onkeydown:i=>{i.keyCode==27?(i.preventDefault(),e.dispatch({effects:Te.of(!1)}),e.focus()):i.keyCode==13&&(i.preventDefault(),r())},onsubmit:i=>{i.preventDefault(),r()}},p("label",e.state.phrase("Go to line"),": ",o)," ",p("button",{class:"cm-button",type:"submit"},e.state.phrase("go")));function r(){let i=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(o.value);if(!i)return;let{state:s}=e,a=s.doc.lineAt(s.selection.main.head),[,l,h,c,f]=i,g=c?+c.slice(1):0,b=h?+h:a.number;if(h&&f){let I=b/100;l&&(I=I*(l=="-"?-1:1)+a.number/s.doc.lines),b=Math.round(s.doc.lines*I)}else h&&l&&(b=b*(l=="-"?-1:1)+a.number);let w=s.doc.line(Math.max(1,Math.min(s.doc.lines,b))),N=d.cursor(w.from+Math.max(0,Math.min(g,w.length)));e.dispatch({effects:[Te.of(!1),m.scrollIntoView(N.from,{y:"center"})],selection:N}),e.focus()}return{dom:n}}const Te=M.define(),Pn=ie.define({create(){return!0},update(e,t){for(let o of t.effects)o.is(Te)&&(e=o.value);return e},provide:e=>xe.from(e,t=>t?lt:null)}),wi=e=>{let t=G(e,lt);if(!t){let o=[Te.of(!0)];e.state.field(Pn,!1)==null&&o.push(M.appendConfig.of([Pn,Si])),e.dispatch({effects:o}),t=G(e,lt)}return t&&t.dom.querySelector("input").select(),!0},Si=m.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Ci={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},Fn=U.define({combine(e){return re(e,Ci,{highlightWordAroundCursor:(t,o)=>t||o,minSelectionLength:Math.min,maxMatches:Math.min})}});function Ai(e){let t=[Ti,Bi];return e&&t.push(Fn.of(e)),t}const Mi=v.mark({class:"cm-selectionMatch"}),Di=v.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Nn(e,t,o,n){return(o==0||e(t.sliceDoc(o-1,o))!=S.Word)&&(n==t.doc.length||e(t.sliceDoc(n,n+1))!=S.Word)}function Li(e,t,o,n){return e(t.sliceDoc(o,o+1))==S.Word&&e(t.sliceDoc(n-1,n))==S.Word}const Bi=je.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(Fn),{state:o}=e,n=o.selection;if(n.ranges.length>1)return v.none;let r=n.main,i,s=null;if(r.empty){if(!t.highlightWordAroundCursor)return v.none;let l=o.wordAt(r.head);if(!l)return v.none;s=o.charCategorizer(r.head),i=o.sliceDoc(l.from,l.to)}else{let l=r.to-r.from;if(l<t.minSelectionLength||l>200)return v.none;if(t.wholeWords){if(i=o.sliceDoc(r.from,r.to),s=o.charCategorizer(r.head),!(Nn(s,o,r.from,r.to)&&Li(s,o,r.from,r.to)))return v.none}else if(i=o.sliceDoc(r.from,r.to),!i)return v.none}let a=[];for(let l of e.visibleRanges){let h=new Q(o.doc,i,l.from,l.to);for(;!h.next().done;){let{from:c,to:f}=h.value;if((!s||Nn(s,o,c,f))&&(r.empty&&c<=r.from&&f>=r.to?a.push(Di.range(c,f)):(c>=r.to||f<=r.from)&&a.push(Mi.range(c,f)),a.length>t.maxMatches))return v.none}}return v.set(a)}},{decorations:e=>e.decorations}),Ti=m.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Ri=({state:e,dispatch:t})=>{let{selection:o}=e,n=d.create(o.ranges.map(r=>e.wordAt(r.head)||d.cursor(r.head)),o.mainIndex);return n.eq(o)?!1:(t(e.update({selection:n})),!0)};function Oi(e,t){let{main:o,ranges:n}=e.selection,r=e.wordAt(o.head),i=r&&r.from==o.from&&r.to==o.to;for(let s=!1,a=new Q(e.doc,t,n[n.length-1].to);;)if(a.next(),a.done){if(s)return null;a=new Q(e.doc,t,0,Math.max(0,n[n.length-1].from-1)),s=!0}else{if(s&&n.some(l=>l.from==a.value.from))continue;if(i){let l=e.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}const Ei=({state:e,dispatch:t})=>{let{ranges:o}=e.selection;if(o.some(i=>i.from===i.to))return Ri({state:e,dispatch:t});let n=e.sliceDoc(o[0].from,o[0].to);if(e.selection.ranges.some(i=>e.sliceDoc(i.from,i.to)!=n))return!1;let r=Oi(e,n);return r?(t(e.update({selection:e.selection.addRange(d.range(r.from,r.to),!1),effects:m.scrollIntoView(r.to)})),!0):!1},Z=U.define({combine(e){return re(e,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:t=>new Ji(t),scrollToMatch:t=>m.scrollIntoView(t)})}});class Hn{constructor(t){this.search=t.search,this.caseSensitive=!!t.caseSensitive,this.literal=!!t.literal,this.regexp=!!t.regexp,this.replace=t.replace||"",this.valid=!!this.search&&(!this.regexp||xi(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!t.wholeWord}unquote(t){return this.literal?t:t.replace(/\\([nrt\\])/g,(o,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp&&this.wholeWord==t.wholeWord}create(){return this.regexp?new Pi(this):new Ii(this)}getCursor(t,o=0,n){let r=t.doc?t:K.create({doc:t});return n==null&&(n=r.doc.length),this.regexp?X(this,r,o,n):Y(this,r,o,n)}}class zn{constructor(t){this.spec=t}}function Y(e,t,o,n){return new Q(t.doc,e.unquoted,o,n,e.caseSensitive?void 0:r=>r.toLowerCase(),e.wholeWord?Wi(t.doc,t.charCategorizer(t.selection.main.head)):void 0)}function Wi(e,t){return(o,n,r,i)=>((i>o||i+r.length<n)&&(i=Math.max(0,o-2),r=e.sliceString(i,Math.min(e.length,n+2))),(t(Re(r,o-i))!=S.Word||t(Oe(r,o-i))!=S.Word)&&(t(Oe(r,n-i))!=S.Word||t(Re(r,n-i))!=S.Word))}class Ii extends zn{constructor(t){super(t)}nextMatch(t,o,n){let r=Y(this.spec,t,n,t.doc.length).nextOverlapping();return r.done&&(r=Y(this.spec,t,0,o).nextOverlapping()),r.done?null:r.value}prevMatchInRange(t,o,n){for(let r=n;;){let i=Math.max(o,r-1e4-this.spec.unquoted.length),s=Y(this.spec,t,i,r),a=null;for(;!s.nextOverlapping().done;)a=s.value;if(a)return a;if(i==o)return null;r-=1e4}}prevMatch(t,o,n){return this.prevMatchInRange(t,0,o)||this.prevMatchInRange(t,n,t.doc.length)}getReplacement(t){return this.spec.unquote(this.spec.replace)}matchAll(t,o){let n=Y(this.spec,t,0,t.doc.length),r=[];for(;!n.next().done;){if(r.length>=o)return null;r.push(n.value)}return r}highlight(t,o,n,r){let i=Y(this.spec,t,Math.max(0,o-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,t.doc.length));for(;!i.next().done;)r(i.value.from,i.value.to)}}function X(e,t,o,n){return new In(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:e.wholeWord?qi(t.charCategorizer(t.selection.main.head)):void 0},o,n)}function Re(e,t){return e.slice(q(e,t,!1),t)}function Oe(e,t){return e.slice(t,q(e,t))}function qi(e){return(t,o,n)=>!n[0].length||(e(Re(n.input,n.index))!=S.Word||e(Oe(n.input,n.index))!=S.Word)&&(e(Oe(n.input,n.index+n[0].length))!=S.Word||e(Re(n.input,n.index+n[0].length))!=S.Word)}class Pi extends zn{nextMatch(t,o,n){let r=X(this.spec,t,n,t.doc.length).next();return r.done&&(r=X(this.spec,t,0,o).next()),r.done?null:r.value}prevMatchInRange(t,o,n){for(let r=1;;r++){let i=Math.max(o,n-r*1e4),s=X(this.spec,t,i,n),a=null;for(;!s.next().done;)a=s.value;if(a&&(i==o||a.from>i+10))return a;if(i==o)return null}}prevMatch(t,o,n){return this.prevMatchInRange(t,0,o)||this.prevMatchInRange(t,n,t.doc.length)}getReplacement(t){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(o,n)=>n=="$"?"$":n=="&"?t.match[0]:n!="0"&&+n<t.match.length?t.match[n]:o)}matchAll(t,o){let n=X(this.spec,t,0,t.doc.length),r=[];for(;!n.next().done;){if(r.length>=o)return null;r.push(n.value)}return r}highlight(t,o,n,r){let i=X(this.spec,t,Math.max(0,o-250),Math.min(n+250,t.doc.length));for(;!i.next().done;)r(i.value.from,i.value.to)}}const le=M.define(),ct=M.define(),F=ie.define({create(e){return new ht(ft(e).create(),null)},update(e,t){for(let o of t.effects)o.is(le)?e=new ht(o.value.create(),e.panel):o.is(ct)&&(e=new ht(e.query,o.value?ut:null));return e},provide:e=>xe.from(e,t=>t.panel)});class ht{constructor(t,o){this.query=t,this.panel=o}}const Fi=v.mark({class:"cm-searchMatch"}),Ni=v.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Hi=je.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(F))}update(e){let t=e.state.field(F);(t!=e.startState.field(F)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return v.none;let{view:o}=this,n=new Rt;for(let r=0,i=o.visibleRanges,s=i.length;r<s;r++){let{from:a,to:l}=i[r];for(;r<s-1&&l>i[r+1].from-2*250;)l=i[++r].to;e.highlight(o.state,a,l,(h,c)=>{let f=o.state.selection.ranges.some(g=>g.from==h&&g.to==c);n.add(h,c,f?Ni:Fi)})}return n.finish()}},{decorations:e=>e.decorations});function ce(e){return t=>{let o=t.state.field(F,!1);return o&&o.query.spec.valid?e(t,o):Jn(t)}}const Ee=ce((e,{query:t})=>{let{to:o}=e.state.selection.main,n=t.nextMatch(e.state,o,o);if(!n)return!1;let r=d.single(n.from,n.to),i=e.state.facet(Z);return e.dispatch({selection:r,effects:[dt(e,n),i.scrollToMatch(r.main,e)],userEvent:"select.search"}),Un(e),!0}),We=ce((e,{query:t})=>{let{state:o}=e,{from:n}=o.selection.main,r=t.prevMatch(o,n,n);if(!r)return!1;let i=d.single(r.from,r.to),s=e.state.facet(Z);return e.dispatch({selection:i,effects:[dt(e,r),s.scrollToMatch(i.main,e)],userEvent:"select.search"}),Un(e),!0}),zi=ce((e,{query:t})=>{let o=t.matchAll(e.state,1e3);return!o||!o.length?!1:(e.dispatch({selection:d.create(o.map(n=>d.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),Vi=({state:e,dispatch:t})=>{let o=e.selection;if(o.ranges.length>1||o.main.empty)return!1;let{from:n,to:r}=o.main,i=[],s=0;for(let a=new Q(e.doc,e.sliceDoc(n,r));!a.next().done;){if(i.length>1e3)return!1;a.value.from==n&&(s=i.length),i.push(d.range(a.value.from,a.value.to))}return t(e.update({selection:d.create(i,s),userEvent:"select.search.matches"})),!0},Vn=ce((e,{query:t})=>{let{state:o}=e,{from:n,to:r}=o.selection.main;if(o.readOnly)return!1;let i=t.nextMatch(o,n,n);if(!i)return!1;let s=[],a,l,h=[];if(i.from==n&&i.to==r&&(l=o.toText(t.getReplacement(i)),s.push({from:i.from,to:i.to,insert:l}),i=t.nextMatch(o,i.from,i.to),h.push(m.announce.of(o.phrase("replaced match on line $",o.doc.lineAt(n).number)+"."))),i){let c=s.length==0||s[0].from>=i.to?0:i.to-i.from-l.length;a=d.single(i.from-c,i.to-c),h.push(dt(e,i)),h.push(o.facet(Z).scrollToMatch(a.main,e))}return e.dispatch({changes:s,selection:a,effects:h,userEvent:"input.replace"}),!0}),$i=ce((e,{query:t})=>{if(e.state.readOnly)return!1;let o=t.matchAll(e.state,1e9).map(r=>{let{from:i,to:s}=r;return{from:i,to:s,insert:t.getReplacement(r)}});if(!o.length)return!1;let n=e.state.phrase("replaced $ matches",o.length)+".";return e.dispatch({changes:o,effects:m.announce.of(n),userEvent:"input.replace.all"}),!0});function ut(e){return e.state.facet(Z).createPanel(e)}function ft(e,t){var o,n,r,i,s;let a=e.selection.main,l=a.empty||a.to>a.from+100?"":e.sliceDoc(a.from,a.to);if(t&&!l)return t;let h=e.facet(Z);return new Hn({search:((o=t==null?void 0:t.literal)!==null&&o!==void 0?o:h.literal)?l:l.replace(/\n/g,"\\n"),caseSensitive:(n=t==null?void 0:t.caseSensitive)!==null&&n!==void 0?n:h.caseSensitive,literal:(r=t==null?void 0:t.literal)!==null&&r!==void 0?r:h.literal,regexp:(i=t==null?void 0:t.regexp)!==null&&i!==void 0?i:h.regexp,wholeWord:(s=t==null?void 0:t.wholeWord)!==null&&s!==void 0?s:h.wholeWord})}function $n(e){let t=G(e,ut);return t&&t.dom.querySelector("[main-field]")}function Un(e){let t=$n(e);t&&t==e.root.activeElement&&t.select()}const Jn=e=>{let t=e.state.field(F,!1);if(t&&t.panel){let o=$n(e);if(o&&o!=e.root.activeElement){let n=ft(e.state,t.query.spec);n.valid&&e.dispatch({effects:le.of(n)}),o.focus(),o.select()}}else e.dispatch({effects:[ct.of(!0),t?le.of(ft(e.state,t.query.spec)):M.appendConfig.of(Ki)]});return!0},Gn=e=>{let t=e.state.field(F,!1);if(!t||!t.panel)return!1;let o=G(e,ut);return o&&o.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:ct.of(!1)}),!0},Ui=[{key:"Mod-f",run:Jn,scope:"editor search-panel"},{key:"F3",run:Ee,shift:We,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Ee,shift:We,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Gn,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Vi},{key:"Mod-Alt-g",run:wi},{key:"Mod-d",run:Ei,preventDefault:!0}];class Ji{constructor(t){this.view=t;let o=this.query=t.state.field(F).query.spec;this.commit=this.commit.bind(this),this.searchField=p("input",{value:o.search,placeholder:C(t,"Find"),"aria-label":C(t,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=p("input",{value:o.replace,placeholder:C(t,"Replace"),"aria-label":C(t,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=p("input",{type:"checkbox",name:"case",form:"",checked:o.caseSensitive,onchange:this.commit}),this.reField=p("input",{type:"checkbox",name:"re",form:"",checked:o.regexp,onchange:this.commit}),this.wordField=p("input",{type:"checkbox",name:"word",form:"",checked:o.wholeWord,onchange:this.commit});function n(r,i,s){return p("button",{class:"cm-button",name:r,onclick:i,type:"button"},s)}this.dom=p("div",{onkeydown:r=>this.keydown(r),class:"cm-search"},[this.searchField,n("next",()=>Ee(t),[C(t,"next")]),n("prev",()=>We(t),[C(t,"previous")]),n("select",()=>zi(t),[C(t,"all")]),p("label",null,[this.caseField,C(t,"match case")]),p("label",null,[this.reField,C(t,"regexp")]),p("label",null,[this.wordField,C(t,"by word")]),...t.state.readOnly?[]:[p("br"),this.replaceField,n("replace",()=>Vn(t),[C(t,"replace")]),n("replaceAll",()=>$i(t),[C(t,"replace all")])],p("button",{name:"close",onclick:()=>Gn(t),"aria-label":C(t,"close"),type:"button"},["\xD7"])])}commit(){let t=new Hn({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});t.eq(this.query)||(this.query=t,this.view.dispatch({effects:le.of(t)}))}keydown(t){Ot(this.view,t,"search-panel")?t.preventDefault():t.keyCode==13&&t.target==this.searchField?(t.preventDefault(),(t.shiftKey?We:Ee)(this.view)):t.keyCode==13&&t.target==this.replaceField&&(t.preventDefault(),Vn(this.view))}update(t){for(let o of t.transactions)for(let n of o.effects)n.is(le)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(t){this.query=t,this.searchField.value=t.search,this.replaceField.value=t.replace,this.caseField.checked=t.caseSensitive,this.reField.checked=t.regexp,this.wordField.checked=t.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(Z).top}}function C(e,t){return e.state.phrase(t)}const Ie=30,qe=/[\s\.,:;?!]/;function dt(e,{from:t,to:o}){let n=e.state.doc.lineAt(t),r=e.state.doc.lineAt(o).to,i=Math.max(n.from,t-Ie),s=Math.min(r,o+Ie),a=e.state.sliceDoc(i,s);if(i!=n.from){for(let l=0;l<Ie;l++)if(!qe.test(a[l+1])&&qe.test(a[l])){a=a.slice(l);break}}if(s!=r){for(let l=a.length-1;l>a.length-Ie;l--)if(!qe.test(a[l-1])&&qe.test(a[l])){a=a.slice(0,l);break}}return m.announce.of(`${e.state.phrase("current match")}. ${a} ${e.state.phrase("on line")} ${n.number}.`)}const Gi=m.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),Ki=[F,Tt.low(Hi),Gi];class ji{constructor(t,o,n){this.from=t,this.to=o,this.diagnostic=n}}class H{constructor(t,o,n){this.diagnostics=t,this.panel=o,this.selected=n}static init(t,o,n){let r=t,i=n.facet(Zn).markerFilter;i&&(r=i(r,n));let s=v.set(r.map(a=>a.from==a.to||a.from==a.to-1&&n.doc.lineAt(a.from).to==a.from?v.widget({widget:new os(a),diagnostic:a}).range(a.from):v.mark({attributes:{class:"cm-lintRange cm-lintRange-"+a.severity+(a.markClass?" "+a.markClass:"")},diagnostic:a,inclusive:!0}).range(a.from,a.to)),!0);return new H(s,o,_(s))}}function _(e,t=null,o=0){let n=null;return e.between(o,1e9,(r,i,{spec:s})=>{if(!(t&&s.diagnostic!=t))return n=new ji(r,i,s.diagnostic),!1}),n}function Qi(e,t){let o=e.startState.doc.lineAt(t.pos);return!!(e.effects.some(n=>n.is(Kn))||e.changes.touchesRange(o.from,o.to))}function Zi(e,t){return e.field(A,!1)?t:t.concat(M.appendConfig.of(ss))}const Kn=M.define(),mt=M.define(),jn=M.define(),A=ie.define({create(){return new H(v.none,null,null)},update(e,t){if(t.docChanged){let o=e.diagnostics.map(t.changes),n=null;if(e.selected){let r=t.changes.mapPos(e.selected.from,1);n=_(o,e.selected.diagnostic,r)||_(o,null,r)}e=new H(o,e.panel,n)}for(let o of t.effects)o.is(Kn)?e=H.init(o.value,e.panel,t.state):o.is(mt)?e=new H(e.diagnostics,o.value?He.open:null,e.selected):o.is(jn)&&(e=new H(e.diagnostics,e.panel,o.value));return e},provide:e=>[xe.from(e,t=>t.panel),m.decorations.from(e,t=>t.diagnostics)]}),Yi=v.mark({class:"cm-lintRange cm-lintRange-active",inclusive:!0});function Xi(e,t,o){let{diagnostics:n}=e.state.field(A),r=[],i=2e8,s=0;n.between(t-(o<0?1:0),t+(o>0?1:0),(l,h,{spec:c})=>{t>=l&&t<=h&&(l==h||(t>l||o>0)&&(t<h||o<0))&&(r.push(c.diagnostic),i=Math.min(l,i),s=Math.max(h,s))});let a=e.state.facet(Zn).tooltipFilter;return a&&(r=a(r,e.state)),r.length?{pos:i,end:s,above:e.state.doc.lineAt(i).to<s,create(){return{dom:_i(e,r)}}}:null}function _i(e,t){return p("ul",{class:"cm-tooltip-lint"},t.map(o=>Xn(e,o,!1)))}const es=e=>{let t=e.state.field(A,!1);(!t||!t.panel)&&e.dispatch({effects:Zi(e.state,[mt.of(!0)])});let o=G(e,He.open);return o&&o.dom.querySelector(".cm-panel-lint ul").focus(),!0},Qn=e=>{let t=e.state.field(A,!1);return!t||!t.panel?!1:(e.dispatch({effects:mt.of(!1)}),!0)},ts=e=>{let t=e.state.field(A,!1);if(!t)return!1;let o=e.state.selection.main,n=t.diagnostics.iter(o.to+1);return!n.value&&(n=t.diagnostics.iter(0),!n.value||n.from==o.from&&n.to==o.to)?!1:(e.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},ns=[{key:"Mod-Shift-m",run:es,preventDefault:!0},{key:"F8",run:ts}],Zn=U.define({combine(e){return Object.assign({sources:e.map(t=>t.source).filter(t=>t!=null)},re(e.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(t,o)=>t?o?n=>t(n)||o(n):t:o}))}});function Yn(e){let t=[];if(e)e:for(let{name:o}of e){for(let n=0;n<o.length;n++){let r=o[n];if(/[a-zA-Z]/.test(r)&&!t.some(i=>i.toLowerCase()==r.toLowerCase())){t.push(r);continue e}}t.push("")}return t}function Xn(e,t,o){var n;let r=o?Yn(t.actions):[];return p("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},p("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage():t.message),(n=t.actions)===null||n===void 0?void 0:n.map((i,s)=>{let a=!1,l=g=>{if(g.preventDefault(),a)return;a=!0;let b=_(e.state.field(A).diagnostics,t);b&&i.apply(e,b.from,b.to)},{name:h}=i,c=r[s]?h.indexOf(r[s]):-1,f=c<0?h:[h.slice(0,c),p("u",h.slice(c,c+1)),h.slice(c+1)];return p("button",{type:"button",class:"cm-diagnosticAction",onclick:l,onmousedown:l,"aria-label":` Action: ${h}${c<0?"":` (access key "${r[s]})"`}.`},f)}),t.source&&p("div",{class:"cm-diagnosticSource"},t.source))}class os extends Wt{constructor(t){super(),this.diagnostic=t}eq(t){return t.diagnostic==this.diagnostic}toDOM(){return p("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class _n{constructor(t,o){this.diagnostic=o,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Xn(t,o,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class He{constructor(t){this.view=t,this.items=[];let o=r=>{if(r.keyCode==27)Qn(this.view),this.view.focus();else if(r.keyCode==38||r.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(r.keyCode==40||r.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(r.keyCode==36)this.moveSelection(0);else if(r.keyCode==35)this.moveSelection(this.items.length-1);else if(r.keyCode==13)this.view.focus();else if(r.keyCode>=65&&r.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:i}=this.items[this.selectedIndex],s=Yn(i.actions);for(let a=0;a<s.length;a++)if(s[a].toUpperCase().charCodeAt(0)==r.keyCode){let l=_(this.view.state.field(A).diagnostics,i);l&&i.actions[a].apply(t,l.from,l.to)}}else return;r.preventDefault()},n=r=>{for(let i=0;i<this.items.length;i++)this.items[i].dom.contains(r.target)&&this.moveSelection(i)};this.list=p("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:o,onclick:n}),this.dom=p("div",{class:"cm-panel-lint"},this.list,p("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>Qn(this.view)},"\xD7")),this.update()}get selectedIndex(){let t=this.view.state.field(A).selected;if(!t)return-1;for(let o=0;o<this.items.length;o++)if(this.items[o].diagnostic==t.diagnostic)return o;return-1}update(){let{diagnostics:t,selected:o}=this.view.state.field(A),n=0,r=!1,i=null;for(t.between(0,this.view.state.doc.length,(s,a,{spec:l})=>{let h=-1,c;for(let f=n;f<this.items.length;f++)if(this.items[f].diagnostic==l.diagnostic){h=f;break}h<0?(c=new _n(this.view,l.diagnostic),this.items.splice(n,0,c),r=!0):(c=this.items[h],h>n&&(this.items.splice(n,h-n),r=!0)),o&&c.diagnostic==o.diagnostic?c.dom.hasAttribute("aria-selected")||(c.dom.setAttribute("aria-selected","true"),i=c):c.dom.hasAttribute("aria-selected")&&c.dom.removeAttribute("aria-selected"),n++});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)r=!0,this.items.pop();this.items.length==0&&(this.items.push(new _n(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),r=!0),i?(this.list.setAttribute("aria-activedescendant",i.id),this.view.requestMeasure({key:this,read:()=>({sel:i.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:s,panel:a})=>{let l=a.height/this.list.offsetHeight;s.top<a.top?this.list.scrollTop-=(a.top-s.top)/l:s.bottom>a.bottom&&(this.list.scrollTop+=(s.bottom-a.bottom)/l)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),r&&this.sync()}sync(){let t=this.list.firstChild;function o(){let n=t;t=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;t!=n.dom;)o();t=n.dom.nextSibling}else this.list.insertBefore(n.dom,t);for(;t;)o()}moveSelection(t){if(this.selectedIndex<0)return;let o=this.view.state.field(A),n=_(o.diagnostics,this.items[t].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:jn.of(n)})}static open(t){return new He(t)}}function rs(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}function Pe(e){return rs(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const is=m.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Pe("#d11")},".cm-lintRange-warning":{backgroundImage:Pe("orange")},".cm-lintRange-info":{backgroundImage:Pe("#999")},".cm-lintRange-hint":{backgroundImage:Pe("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),ss=[A,m.decorations.compute([A],e=>{let{selected:t,panel:o}=e.field(A);return!t||!o||t.from==t.to?v.none:v.set([Yi.range(t.from,t.to)])}),Et(Xi,{hideOn:Qi}),is];var pt=function(e){e===void 0&&(e={});var{crosshairCursor:t=!1}=e,o=[];e.closeBracketsKeymap!==!1&&(o=o.concat(ko)),e.defaultKeymap!==!1&&(o=o.concat(Rn)),e.searchKeymap!==!1&&(o=o.concat(Ui)),e.historyKeymap!==!1&&(o=o.concat(Zt)),e.foldKeymap!==!1&&(o=o.concat(xo)),e.completionKeymap!==!1&&(o=o.concat(wo)),e.lintKeymap!==!1&&(o=o.concat(ns));var n=[];return e.lineNumbers!==!1&&n.push(It()),e.highlightActiveLineGutter!==!1&&n.push(qt()),e.highlightSpecialChars!==!1&&n.push(Qe()),e.history!==!1&&n.push(Gt()),e.foldGutter!==!1&&n.push(So()),e.drawSelection!==!1&&n.push(Ze()),e.dropCursor!==!1&&n.push(Pt()),e.allowMultipleSelections!==!1&&n.push(K.allowMultipleSelections.of(!0)),e.indentOnInput!==!1&&n.push(Co()),e.syntaxHighlighting!==!1&&n.push(Ye(zt,{fallback:!0})),e.bracketMatching!==!1&&n.push(Ao()),e.closeBrackets!==!1&&n.push(Mo()),e.autocompletion!==!1&&n.push(Do()),e.rectangularSelection!==!1&&n.push(Ft()),t!==!1&&n.push(Nt()),e.highlightActiveLine!==!1&&n.push(Ht()),e.highlightSelectionMatches!==!1&&n.push(Ai()),e.tabSize&&typeof e.tabSize=="number"&&n.push(At.of(" ".repeat(e.tabSize))),n.concat([we.of(o.flat())]).filter(Boolean)},as=function(e){e===void 0&&(e={});var t=[];e.defaultKeymap!==!1&&(t=t.concat(Rn)),e.historyKeymap!==!1&&(t=t.concat(Zt));var o=[];return e.highlightSpecialChars!==!1&&o.push(Qe()),e.history!==!1&&o.push(Gt()),e.drawSelection!==!1&&o.push(Ze()),e.syntaxHighlighting!==!1&&o.push(Ye(zt,{fallback:!0})),o.concat([we.of(t.flat())]).filter(Boolean)};const eo="#e5c07b",gt="#e06c75",to="#56b6c2",no="#ffffff",he="#abb2bf",Fe="#7d8799",oo="#61afef",ro="#98c379",vt="#d19a66",io="#c678dd",so="#21252b",bt="#2c313a",yt="#282c34",Ne="#353a42",ao="#3E4451",kt="#528bff",ls={chalky:eo,coral:gt,cyan:to,invalid:no,ivory:he,stone:Fe,malibu:oo,sage:ro,whiskey:vt,violet:io,darkBackground:so,highlightBackground:bt,background:yt,tooltipBackground:Ne,selection:ao,cursor:kt},lo=m.theme({"&":{color:he,backgroundColor:yt},".cm-content":{caretColor:kt},".cm-cursor, .cm-dropCursor":{borderLeftColor:kt},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:ao},".cm-panels":{backgroundColor:so,color:he},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:yt,color:Fe,border:"none"},".cm-activeLineGutter":{backgroundColor:bt},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:Ne},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Ne,borderBottomColor:Ne},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:bt,color:he}}},{dark:!0}),co=Lo.define([{tag:u.keyword,color:io},{tag:[u.name,u.deleted,u.character,u.propertyName,u.macroName],color:gt},{tag:[u.function(u.variableName),u.labelName],color:oo},{tag:[u.color,u.constant(u.name),u.standard(u.name)],color:vt},{tag:[u.definition(u.name),u.separator],color:he},{tag:[u.typeName,u.className,u.number,u.changed,u.annotation,u.modifier,u.self,u.namespace],color:eo},{tag:[u.operator,u.operatorKeyword,u.url,u.escape,u.regexp,u.link,u.special(u.string)],color:to},{tag:[u.meta,u.comment],color:Fe},{tag:u.strong,fontWeight:"bold"},{tag:u.emphasis,fontStyle:"italic"},{tag:u.strikethrough,textDecoration:"line-through"},{tag:u.link,color:Fe,textDecoration:"underline"},{tag:u.heading,fontWeight:"bold",color:gt},{tag:[u.atom,u.bool,u.special(u.variableName)],color:vt},{tag:[u.processingInstruction,u.string,u.inserted],color:ro},{tag:u.invalid,color:no}]),ho=[lo,Ye(co)];var uo=m.theme({"&":{backgroundColor:"#fff"}},{dark:!1}),fo=function(e){e===void 0&&(e={});var{indentWithTab:t=!0,editable:o=!0,readOnly:n=!1,theme:r="light",placeholder:i="",basicSetup:s=!0}=e,a=[];switch(t&&a.unshift(we.of([ki])),s&&(typeof s=="boolean"?a.unshift(pt()):a.unshift(pt(s))),i&&a.unshift(Vt(i)),r){case"light":a.push(uo);break;case"dark":a.push(ho);break;case"none":break;default:a.push(r);break}return o===!1&&a.push(m.editable.of(!1)),n&&a.push(K.readOnly.of(!0)),[...a]},mo=e=>({line:e.state.doc.lineAt(e.state.selection.main.from),lineCount:e.state.doc.lines,lineBreak:e.state.lineBreak,length:e.state.doc.length,readOnly:e.state.readOnly,tabSize:e.state.tabSize,selection:e.state.selection,selectionAsSingle:e.state.selection.asSingle().main,ranges:e.state.selection.ranges,selectionCode:e.state.sliceDoc(e.state.selection.main.from,e.state.selection.main.to),selections:e.state.selection.ranges.map(t=>e.state.sliceDoc(t.from,t.to)),selectedText:e.state.selection.ranges.some(t=>!t.empty)}),po=ke.define(),cs=[];function go(e){var{value:t,selection:o,onChange:n,onStatistics:r,onCreateEditor:i,onUpdate:s,extensions:a=cs,autoFocus:l,theme:h="light",height:c=null,minHeight:f=null,maxHeight:g=null,width:b=null,minWidth:w=null,maxWidth:N=null,placeholder:I="",editable:ue=!0,readOnly:fe=!1,indentWithTab:de=!0,basicSetup:me=!0,root:ze,initialState:te}=e,[z,pe]=D.useState(),[y,W]=D.useState(),[V,$]=D.useState(),Ve=m.theme({"&":{height:c,minHeight:f,maxHeight:g,width:b,minWidth:w,maxWidth:N},"& .cm-scroller":{height:"100% !important"}}),$e=m.updateListener.of(T=>{if(T.docChanged&&typeof n=="function"&&!T.transactions.some(yo=>yo.annotation(po))){var oe=T.state.doc,ge=oe.toString();n(ge,T)}r&&r(mo(T))}),bo=fo({theme:h,editable:ue,readOnly:fe,placeholder:I,indentWithTab:de,basicSetup:me}),ne=[$e,Ve,...bo];return s&&typeof s=="function"&&ne.push(m.updateListener.of(s)),ne=ne.concat(a),D.useEffect(()=>{if(z&&!V){var T={doc:t,selection:o,extensions:ne},oe=te?K.fromJSON(te.json,T,te.fields):K.create(T);if($(oe),!y){var ge=new m({state:oe,parent:z,root:ze});W(ge),i&&i(ge,oe)}}return()=>{y&&($(void 0),W(void 0))}},[z,V]),D.useEffect(()=>pe(e.container),[e.container]),D.useEffect(()=>()=>{y&&(y.destroy(),W(void 0))},[y]),D.useEffect(()=>{l&&y&&y.focus()},[l,y]),D.useEffect(()=>{y&&y.dispatch({effects:M.reconfigure.of(ne)})},[h,a,c,f,g,b,w,N,I,ue,fe,de,me,n,s]),D.useEffect(()=>{if(t!==void 0){var T=y?y.state.doc.toString():"";y&&t!==T&&y.dispatch({changes:{from:0,to:T.length,insert:t||""},annotations:[po.of(!0)]})}},[t,y]),{state:V,setState:$,view:y,setView:W,container:z,setContainer:pe}}var hs=["className","value","selection","extensions","onChange","onStatistics","onCreateEditor","onUpdate","autoFocus","theme","height","minHeight","maxHeight","width","minWidth","maxWidth","basicSetup","placeholder","indentWithTab","editable","readOnly","root","initialState"],vo=D.forwardRef((e,t)=>{var{className:o,value:n="",selection:r,extensions:i=[],onChange:s,onStatistics:a,onCreateEditor:l,onUpdate:h,autoFocus:c,theme:f="light",height:g,minHeight:b,maxHeight:w,width:N,minWidth:I,maxWidth:ue,basicSetup:fe,placeholder:de,indentWithTab:me,editable:ze,readOnly:te,root:z,initialState:pe}=e,y=Bo(e,hs),W=D.useRef(null),{state:V,view:$,container:Ve}=go({container:W.current,root:z,value:n,autoFocus:c,theme:f,height:g,minHeight:b,maxHeight:w,width:N,minWidth:I,maxWidth:ue,basicSetup:fe,placeholder:de,indentWithTab:me,editable:ze,readOnly:te,selection:r,onChange:s,onStatistics:a,onCreateEditor:l,onUpdate:h,extensions:i,initialState:pe});if(D.useImperativeHandle(t,()=>({editor:W.current,state:V,view:$}),[W,Ve,V,$]),typeof n!="string")throw new Error("value must be typeof string but got "+typeof n);var $e=typeof f=="string"?"cm-theme-"+f:"cm-theme";return To.jsx("div",Ro({ref:W,className:""+$e+(o?" "+o:"")},y))});vo.displayName="CodeMirror";export{ke as Annotation,Oo as AnnotationType,Eo as BidiSpan,Wo as BlockInfo,Io as BlockType,wt as ChangeDesc,xt as ChangeSet,S as CharCategory,qo as Compartment,v as Decoration,Mt as Direction,d as EditorSelection,K as EditorState,m as EditorView,U as Facet,Po as GutterMarker,Fo as Line,No as MapMode,Ho as MatchDecorator,Tt as Prec,zo as Range,Vo as RangeSet,Rt as RangeSetBuilder,$o as RangeValue,Uo as RectangleMarker,Jo as SelectionRange,M as StateEffect,Go as StateEffectType,ie as StateField,Ue as Text,ve as Transaction,je as ViewPlugin,Ko as ViewUpdate,Wt as WidgetType,jo as __test,pt as basicSetup,Qo as closeHoverTooltips,Dt as codePointAt,Bt as codePointSize,ls as color,re as combineConfig,be as countColumn,Nt as crosshairCursor,vo as default,uo as defaultLightThemeOption,Ze as drawSelection,Pt as dropCursor,q as findClusterBreak,Zo as findColumn,Lt as fromCodePoint,fo as getDefaultExtensions,Yo as getDrawSelectionConfig,G as getPanel,mo as getStatistics,Xo as getTooltip,_o as gutter,er as gutterLineClass,tr as gutters,nr as hasHoverTooltips,Ht as highlightActiveLine,qt as highlightActiveLineGutter,Qe as highlightSpecialChars,or as highlightTrailingWhitespace,rr as highlightWhitespace,Et as hoverTooltip,we as keymap,ir as layer,sr as lineNumberMarkers,It as lineNumbers,ar as logException,as as minimalSetup,ho as oneDark,co as oneDarkHighlightStyle,lo as oneDarkTheme,lr as panels,Vt as placeholder,Ft as rectangularSelection,cr as repositionTooltips,Ot as runScopeHandlers,hr as scrollPastEnd,xe as showPanel,ur as showTooltip,fr as tooltips,go as useCodeMirror};
